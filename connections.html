<!doctype html>
<html lang="it" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Futuro Fortissimo — Connessioni fortissime</title>
  <meta name="description" content="Connessioni tra i post Futuro Fortissimo: hub più citati, link interni e percorsi di lettura." />
  <link rel="canonical" href="https://futurofortissimo.github.io/connections.html" />

  <meta property="og:title" content="Futuro Fortissimo — Connessioni fortissime" />
  <meta property="og:description" content="Mappa delle connessioni interne tra post e sub-capitoli." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://futurofortissimo.github.io/connections.html" />
  <meta property="og:image" content="https://futurofortissimo.github.io/logo.png" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Futuro Fortissimo — Connessioni fortissime" />
  <meta name="twitter:description" content="Mappa delle connessioni interne tra post e sub-capitoli." />
  <meta name="twitter:image" content="https://futurofortissimo.github.io/logo.png" />

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=IBM+Plex+Mono:wght@600;700&family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    :root {
      --ff-blue: #4a90e2;
      --ff-red: #d0021b;
      --ff-yellow: #f5a623;
      --ff-green: #2ecc71;
      --ff-black: #0a0a0a;
      --ff-grid: rgba(0, 0, 0, 0.03);
    }
    body {
      font-family: 'Inter', sans-serif;
      background-color: #fdfdfd;
      color: var(--ff-black);
      position: relative;
      min-height: 100vh;
      line-height: 1.6;
    }
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(var(--ff-grid) 1px, transparent 1px),
        linear-gradient(90deg, var(--ff-grid) 1px, transparent 1px);
      background-size: 32px 32px;
      pointer-events: none;
      z-index: -1;
    }
    h1, h2, h3, h4, h5, h6 {
      font-family: 'IBM Plex Mono', monospace;
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }
    .pixel-title { font-family: 'Press Start 2P', monospace; letter-spacing: 0.05em; }
    .brutal-card {
      border: 4px solid var(--ff-black);
      background: #ffffff;
      box-shadow: 6px 6px 0 var(--ff-black);
      padding: 24px;
    }
    .accent-bar { position: relative; }
    .accent-bar::before {
      content: '';
      position: absolute;
      top: -4px; left: -4px; right: -4px;
      height: 10px;
      background: var(--ff-blue);
    }
    .accent-red::before { background: var(--ff-red); }
    .accent-yellow::before { background: var(--ff-yellow); }
    .accent-green::before { background: var(--ff-green); }
    .ff-eyebrow {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 0.75rem;
      letter-spacing: 0.24em;
      text-transform: uppercase;
      font-weight: 700;
    }
    .ff-heading-xl {
      font-size: clamp(1.6rem, 1.2rem + 1vw, 2.2rem);
      line-height: 1.2;
      font-weight: 700;
    }
    .ff-body { font-size: 1rem; line-height: 1.65; }
    .ff-body-sm { font-size: 0.9375rem; line-height: 1.6; }
    .ff-button {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 0.75rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      font-weight: 700;
    }
    .ff-caption {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 0.75rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      font-weight: 700;
    }
    .no-round, .no-round * { border-radius: 0 !important; }
    a:focus-visible, button:focus-visible { outline: 3px solid var(--ff-black); outline-offset: 2px; }
    ::selection { background: #0a0a0a; color: #ffffff; }
  </style>
</head>
<body class="antialiased selection:bg-gray-900 selection:text-white no-round">

  <header class="bg-white" style="border-bottom: 4px solid var(--ff-black);">
    <div class="max-w-5xl mx-auto px-4 py-5 flex items-center justify-between gap-4">
      <div>
        <div class="ff-eyebrow" style="color: var(--ff-green);">Futuro Fortissimo — Grafo</div>
        <h1 class="ff-heading-xl mt-1">Connessioni Fortissime</h1>
        <p class="ff-body-sm mt-1" style="color: #555;">Hub più citati e percorsi di lettura (dal grafo "connections" nel JSON).</p>
      </div>
      <nav class="flex gap-4 flex-wrap justify-end">
        <a class="ff-eyebrow hover:underline" href="/index.html">Home</a>
        <a class="ff-eyebrow hover:underline" href="/book/">Libro</a>
        <a class="ff-eyebrow hover:underline" href="/themes.html">Temi</a>
        <a class="ff-eyebrow hover:underline" href="/connections.html">Connessioni</a>
        <a class="ff-eyebrow hover:underline" href="/note.html">Note</a>
      </nav>
    </div>
  </header>

  <main class="max-w-5xl mx-auto px-4 py-10">

    <!-- Meta info card -->
    <div class="brutal-card accent-bar">
      <div class="ff-eyebrow" style="color: var(--ff-blue);">Generated</div>
      <div id="meta" class="ff-body-sm mt-1" style="color: #555;">Caricamento...</div>
    </div>

    <!-- Top hubs section -->
    <section class="mt-8 brutal-card accent-bar accent-red">
      <h2 class="text-lg font-bold uppercase">Top hub (più citati)</h2>
      <p class="ff-body-sm mt-2" style="color: #555;">Non è "il migliore", è solo ciò che fa da ponte tra pezzi del corpus.</p>
      <ol id="hubs" class="mt-5 space-y-4"></ol>
    </section>

    <!-- Suggested connections -->
    <section class="mt-8 brutal-card accent-bar accent-yellow">
      <h2 class="text-lg font-bold uppercase">Connessioni suggerite (auto)</h2>
      <p class="ff-body-sm mt-2" style="color: #555;">Ponti "forti" calcolati per keyword/overlap. Servono per ispirare cross-link, non come verità assoluta.</p>
      <div id="suggested" class="mt-5 space-y-5"></div>
    </section>

    <!-- Footer note -->
    <section class="mt-10 brutal-card accent-bar accent-green">
      <h2 class="text-base font-bold uppercase">Note</h2>
      <ul class="list-disc pl-5 mt-3 ff-body-sm space-y-2" style="color: #333;">
        <li>Il grafo viene dal campo <code class="ff-caption" style="background: #f5f5f5; padding: 2px 8px; border: 2px solid var(--ff-black);">connections</code> nei subchapters.</li>
        <li>Le "connessioni suggerite" sono automatiche: ottime per brainstorming, da rifinire a mano.</li>
      </ul>
    </section>

  </main>

  <script src="./analytics.js"></script>
  <script>
    async function load() {
      var ts = Date.now();
      var results = await Promise.all([
        fetch('./generated/connections.json?ts=' + ts),
        fetch('./generated/suggested_connections.json?ts=' + ts).catch(function() { return null; })
      ]);

      var connRes = results[0];
      var sugRes = results[1];

      var data = await connRes.json();
      document.getElementById('meta').textContent = 'Nodes: ' + data.totals.nodes + ' \u00b7 Edges: ' + data.totals.edges + ' \u00b7 Updated: ' + new Date(data.generatedAt).toLocaleString();

      // Top hubs
      var hubs = document.getElementById('hubs');
      hubs.innerHTML = '';

      var hubList = (data.topHubs || []).slice(0, 20);
      hubList.forEach(function(h, i) {
        var li = document.createElement('li');
        var url = h.url || null;
        var label = (h.label || h.id).replace(/\s+/g, ' ').trim();

        li.style.borderBottom = '2px solid #eee';
        li.style.paddingBottom = '12px';

        li.innerHTML =
          '<div class="flex items-start justify-between gap-4">' +
            '<div>' +
              '<div class="ff-eyebrow" style="color: #888;">' + h.id + '</div>' +
              '<div class="font-semibold mt-1">' + label + '</div>' +
              '<div class="ff-body-sm mt-1" style="color: #555;">In-degree score: <strong>' + h.score + '</strong></div>' +
            '</div>' +
            (url ? '<a class="ff-button underline flex-shrink-0" data-track="connection_open" href="' + url + '" target="_blank" rel="noopener">Apri</a>' : '') +
          '</div>';

        hubs.appendChild(li);
      });

      // Suggested connections
      var suggestedRoot = document.getElementById('suggested');
      if (!suggestedRoot) return;

      if (!sugRes) {
        suggestedRoot.innerHTML = '<div class="ff-body-sm" style="color: #888;">(non disponibile)</div>';
        return;
      }

      var sug = await sugRes.json();
      var packs = (sug.suggestions || []).slice(0, 6);

      if (!packs.length) {
        suggestedRoot.innerHTML = '<div class="ff-body-sm" style="color: #888;">(nessuna suggerita)</div>';
        return;
      }

      var ACCENT_CYCLE = ['', 'accent-red', 'accent-yellow', 'accent-green'];
      var COLORS = ['var(--ff-blue)', 'var(--ff-red)', 'var(--ff-yellow)', 'var(--ff-green)'];

      suggestedRoot.innerHTML = packs.map(function(p, pi) {
        var items = (p.items || []).slice(0, 8);
        var accentClass = ACCENT_CYCLE[pi % 4];
        var eyebrowColor = COLORS[pi % 4];

        var rows = items.map(function(it) {
          var from = it.from;
          var to = it.to;
          return '<li style="padding: 12px 0; border-bottom: 2px solid #eee;">' +
            '<div class="ff-eyebrow" style="color: ' + eyebrowColor + ';">' + from.id + ' \u2192 ' + to.id + ' \u00b7 strength ' + it.strength + '</div>' +
            '<div class="ff-body-sm mt-2" style="color: #333;">' + (it.bridge || '').trim() + '</div>' +
            '<div class="mt-3 flex flex-wrap gap-4">' +
              (from.url ? '<a class="ff-button underline" href="' + from.url + '" target="_blank" rel="noopener">Apri origine</a>' : '') +
              (to.url ? '<a class="ff-button underline" href="' + to.url + '" target="_blank" rel="noopener">Apri destinazione</a>' : '') +
            '</div>' +
          '</li>';
        }).join('');

        return '<div class="brutal-card accent-bar ' + accentClass + '">' +
          '<div class="ff-eyebrow" style="color: ' + eyebrowColor + ';">' + p.key + '</div>' +
          '<div class="font-semibold mt-2" style="font-family: \'IBM Plex Mono\', monospace; text-transform: uppercase; letter-spacing: 0.03em;">' + p.title + '</div>' +
          '<ul class="mt-4">' + rows + '</ul>' +
        '</div>';
      }).join('');
    }

    load().catch(function(err) {
      document.getElementById('meta').textContent = 'Errore caricamento.';
      console.error(err);
    });
  </script>
</body>
</html>
