<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Futuro Fortissimo â€” Notes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Curated notes and references from the Futuro Fortissimo newsletter: technology, nature, society, books.">
    <link rel="canonical" href="https://futurofortissimo.github.io/en/note.html">

    <link rel="alternate" hreflang="it" href="https://futurofortissimo.github.io/note.html">
    <link rel="alternate" hreflang="en" href="https://futurofortissimo.github.io/en/note.html">
    <link rel="alternate" hreflang="hi" href="https://futurofortissimo.github.io/hi/note.html">

    <meta property="og:title" content="Futuro Fortissimo â€” Notes">
    <meta property="og:description" content="Curated notes and references from the Futuro Fortissimo newsletter: technology, nature, society, books.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://futurofortissimo.github.io/en/note.html">
    <meta property="og:image" content="https://futurofortissimo.github.io/logo.png">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="Futuro Fortissimo">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Futuro Fortissimo â€” Notes">
    <meta name="twitter:description" content="Curated notes and references from the Futuro Fortissimo newsletter: technology, nature, society, books.">
    <meta name="twitter:image" content="https://futurofortissimo.github.io/logo.png">

    <link rel="icon" href="/index_files/ff.webp" type="image/webp">
    <link rel="apple-touch-icon" href="/index_files/ff.webp">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NQ7MQR0VL8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-NQ7MQR0VL8');
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=IBM+Plex+Mono:wght@600;700&family=Press+Start+2P&display=swap" rel="stylesheet">

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "CollectionPage",
      "name": "Futuro Fortissimo â€” Notes",
      "description": "Curated notes and references from the Futuro Fortissimo newsletter: technology, nature, society, books.",
      "url": "https://futurofortissimo.github.io/en/note.html",
      "inLanguage": "en",
      "isPartOf": {
        "@type": "WebSite",
        "name": "Futuro Fortissimo",
        "url": "https://futurofortissimo.github.io/"
      }
    }
    </script>

    <style>
        :root { --ff-blue:#4a90e2; --ff-red:#d0021b; --ff-yellow:#f5a623; --ff-green:#2ecc71; --ff-black:#0a0a0a; --ff-grid:rgba(0,0,0,0.03); }
        body { font-family:'Inter',sans-serif; background-color:#fdfdfd; color:var(--ff-black); min-height:100vh; line-height:1.6; position:relative; }
        body::before { content:''; position:fixed; inset:0; background-image:linear-gradient(var(--ff-grid) 1px,transparent 1px),linear-gradient(90deg,var(--ff-grid) 1px,transparent 1px); background-size:32px 32px; pointer-events:none; z-index:-1; }
        h1,h2,h3,h4,h5,h6 { font-family:'IBM Plex Mono',monospace; letter-spacing:0.03em; text-transform:uppercase; }
        .brutal-card { border:4px solid var(--ff-black); background:#fff; box-shadow:6px 6px 0 var(--ff-black); padding:24px; }
        .accent-bar { position:relative; }
        .accent-bar::before { content:''; position:absolute; top:-4px; left:-4px; right:-4px; height:10px; background:var(--ff-blue); }
        .accent-red::before { background:var(--ff-red); }
        .accent-yellow::before { background:var(--ff-yellow); }
        .accent-green::before { background:var(--ff-green); }
        .ff-eyebrow { font-family:'IBM Plex Mono',monospace; font-size:0.75rem; letter-spacing:0.24em; text-transform:uppercase; font-weight:700; }
        .ff-body { font-size:1rem; line-height:1.65; }
        .ff-body-sm { font-size:0.9375rem; line-height:1.6; }
        .no-round,.no-round * { border-radius:0!important; }
        a:focus-visible { outline:3px solid var(--ff-black); outline-offset:2px; }
        .no-scrollbar::-webkit-scrollbar { display:none; }
        .no-scrollbar { -ms-overflow-style:none; scrollbar-width:none; }

        .ff-input {
            border:3px solid var(--ff-black);
            border-radius:0;
            padding:10px 14px;
            font-family:'Inter',sans-serif;
            font-size:1rem;
            outline:none;
            transition:box-shadow 0.15s;
        }
        .ff-input:focus {
            box-shadow:4px 4px 0 var(--ff-black);
        }
        .tag-pill {
            border:2px solid var(--ff-black);
            border-radius:0;
            padding:4px 10px;
            cursor:pointer;
            font-size:1.1rem;
            background:#fff;
            transition:background 0.15s, transform 0.1s;
            user-select:none;
        }
        .tag-pill:hover {
            background:#f0f0f0;
            transform:translateY(-1px);
        }
        .tag-pill.selected {
            background:var(--ff-yellow);
            box-shadow:3px 3px 0 var(--ff-black);
        }
        .note-card {
            transition:transform 0.15s, box-shadow 0.15s;
        }
        .note-card:hover {
            transform:translate(-2px,-2px);
            box-shadow:8px 8px 0 var(--ff-black);
        }
        .ff-lang-bar {
            font-family:'IBM Plex Mono',monospace;
            font-size:0.6875rem;
            letter-spacing:0.16em;
            text-transform:uppercase;
            font-weight:700;
            background:var(--ff-black);
            color:#fff;
        }
        .ff-lang-bar a {
            color:rgba(255,255,255,0.55);
            text-decoration:none;
            padding:6px 8px;
            transition:color 0.15s ease;
        }
        .ff-lang-bar a:hover {
            color:#fff;
        }
        .ff-lang-bar a[aria-current="page"] {
            color:#fff;
            border-bottom:2px solid var(--ff-yellow);
        }
    </style>
</head>
<body class="no-round">

<!-- Language Switcher Bar -->
<nav class="ff-lang-bar" aria-label="Language">
    <div class="max-w-5xl mx-auto flex items-center justify-end gap-1 px-4 py-1">
        <a href="/note.html" title="Italiano">IT</a>
        <span class="text-gray-600 select-none">/</span>
        <a href="/en/note.html" aria-current="page" title="English">EN</a>
        <span class="text-gray-600 select-none">/</span>
        <a href="/hi/note.html" title="Hindi">HI</a>
    </div>
</nav>

<header class="bg-white" style="border-bottom:4px solid var(--ff-black)">
    <div class="max-w-5xl mx-auto px-6 py-5 flex items-center justify-between gap-4">
        <div>
            <div class="ff-eyebrow text-gray-500">Futuro Fortissimo â€” Notebook</div>
            <h1 class="text-2xl font-bold tracking-tight mt-1" style="font-size:clamp(1.4rem,1.1rem+1vw,2rem)">NOTES</h1>
        </div>
        <nav class="flex gap-4 flex-shrink-0">
            <a class="ff-eyebrow text-gray-600 hover:text-black hover:underline" href="/en/index.html">Home</a>
            <a class="ff-eyebrow text-gray-600 hover:text-black hover:underline" href="/book/">Book</a>
            <a class="ff-eyebrow text-gray-600 hover:text-black hover:underline" href="/en/themes.html">Themes</a>
            <a class="ff-eyebrow text-gray-600 hover:text-black hover:underline" href="/en/note.html">Notes</a>
            <a class="ff-eyebrow text-gray-600 hover:text-black hover:underline" href="/en/connections.html">Connections</a>
        </nav>
    </div>
</header>

<main class="max-w-5xl mx-auto px-6 py-8">
    <!-- Search / Filter bar -->
    <div class="brutal-card accent-bar mb-8">
        <div class="flex flex-col md:flex-row gap-4 items-start md:items-center">
            <div class="flex gap-3 flex-1 w-full">
                <input type="text" id="search-input" class="ff-input flex-1" placeholder="Search notes...">
                <button id="refresh-btn" class="tag-pill font-bold" title="Reset">&#x21bb;</button>
                <button id="lang-btn" class="tag-pill ff-eyebrow" style="font-size:0.7rem;padding:6px 12px;">IT</button>
            </div>
            <div class="flex flex-wrap gap-2" id="tag-filters">
                <!-- Tag pills inserted dynamically -->
            </div>
        </div>
    </div>

    <!-- Count -->
    <div class="ff-eyebrow text-gray-500 mb-4" id="count-display">Loading...</div>

    <!-- Notes Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="notes-grid">
        <!-- Cards inserted dynamically -->
    </div>
</main>

<script>
document.addEventListener('DOMContentLoaded', () => {
    let currentLanguage = 'en';
    const searchInput = document.getElementById('search-input');
    const refreshBtn = document.getElementById('refresh-btn');
    const langBtn = document.getElementById('lang-btn');
    const tagFiltersContainer = document.getElementById('tag-filters');
    const notesGrid = document.getElementById('notes-grid');
    const countDisplay = document.getElementById('count-display');

    const TAG_EMOJIS = ['ðŸ’»','ðŸ§ ','â¤ï¸','ðŸ‘¥','ðŸŽ¨','ðŸƒ','ðŸ’Š','ðŸ’¸','âš½','ðŸ½','ðŸŽ™ï¸','ðŸ“š','ðŸ¥½','ðŸš•'];
    let allNotes = [];
    let selectedTags = new Set();

    // Build tag filter pills
    TAG_EMOJIS.forEach(emoji => {
        const pill = document.createElement('button');
        pill.className = 'tag-pill';
        pill.textContent = emoji;
        pill.setAttribute('data-tag', emoji);
        pill.addEventListener('click', () => {
            if (selectedTags.has(emoji)) {
                selectedTags.delete(emoji);
                pill.classList.remove('selected');
            } else {
                selectedTags.add(emoji);
                pill.classList.add('selected');
            }
            applyFilters();
        });
        tagFiltersContainer.appendChild(pill);
    });

    // English stop words for search filtering
    const stopWords = new Set([
        'the','be','to','of','and','a','in','that','have','i','it','for','not','on',
        'with','he','as','you','do','at','this','but','his','by','from','they','we',
        'her','she','or','an','will','my','one','all','would','there','their','what',
        'so','up','out','if','about','who','get','which','go','me','when','find','can',
        'no','how','did','just','more','been','like','other','than','then','its','our',
        'two','also','back','after','use','way','even','new','any','these','only',
        'because','where','most','into','over','much','many'
    ]);

    function shuffle(arr) {
        const a = [...arr];
        for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    }

    function applyFilters() {
        const searchText = searchInput.value.toLowerCase().trim();
        const searchWords = searchText.split(/\s+/).filter(w => w && !stopWords.has(w));
        let filtered = allNotes;

        if (searchWords.length > 0) {
            filtered = filtered.filter(note => {
                const combined = `${note.tags.join(' ')} ${note.title} ${note.description} ${note.hashtags || ''}`.toLowerCase();
                return searchWords.every(word => combined.includes(word));
            });
        }

        if (selectedTags.size > 0) {
            filtered = filtered.filter(note => {
                return [...selectedTags].every(tag => note.tags.includes(tag));
            });
        }

        const total = filtered.length;
        const shuffled = shuffle(filtered);
        const display = shuffled.slice(0, 40);

        countDisplay.textContent = currentLanguage === 'en'
            ? `${display.length} notes of ${total}`
            : `${display.length} note su ${total}`;

        renderNotes(display);
    }

    function renderNotes(notes) {
        notesGrid.innerHTML = '';
        if (notes.length === 0) {
            notesGrid.innerHTML = '<div class="col-span-full text-center py-12"><p class="ff-body text-gray-500">' +
                (currentLanguage === 'en' ? 'No notes found.' : 'Nessuna nota trovata.') + '</p></div>';
            return;
        }

        const accentClasses = ['accent-bar', 'accent-bar accent-red', 'accent-bar accent-yellow', 'accent-bar accent-green'];

        notes.forEach((note, i) => {
            const card = document.createElement('div');
            card.className = `brutal-card note-card ${accentClasses[i % accentClasses.length]}`;

            const tagsSpan = document.createElement('div');
            tagsSpan.className = 'text-lg mb-2';
            tagsSpan.textContent = note.tags.join(' ');

            const titleLink = document.createElement('a');
            titleLink.className = 'text-base font-bold mb-2 leading-snug block hover:underline';
            titleLink.style.color = 'var(--ff-black)';
            titleLink.href = note.url;
            titleLink.target = '_blank';
            titleLink.rel = 'noopener';
            titleLink.textContent = note.title;

            const desc = document.createElement('p');
            desc.className = 'ff-body-sm text-gray-600 mb-2';
            desc.textContent = note.description;

            const hashtags = document.createElement('div');
            hashtags.className = 'ff-eyebrow text-gray-400';
            hashtags.style.fontSize = '0.65rem';
            hashtags.textContent = note.hashtags || '';

            card.appendChild(tagsSpan);
            card.appendChild(titleLink);
            card.appendChild(desc);
            if (note.hashtags) card.appendChild(hashtags);
            notesGrid.appendChild(card);
        });
    }

    async function loadNotes() {
        const file = currentLanguage === 'en' ? '/notes_en.json' : '/notes.json';
        try {
            const res = await fetch(file);
            if (!res.ok) throw new Error('HTTP ' + res.status);
            const data = await res.json();
            allNotes = data.notes || data;
            applyFilters();
        } catch (err) {
            console.error('Error loading notes:', err);
            notesGrid.innerHTML = '<div class="col-span-full text-center py-12"><p class="ff-body text-gray-500">Error loading notes.</p></div>';
        }
    }

    searchInput.addEventListener('input', applyFilters);
    searchInput.addEventListener('keypress', e => { if (e.key === 'Enter') applyFilters(); });

    refreshBtn.addEventListener('click', () => {
        searchInput.value = '';
        selectedTags.clear();
        tagFiltersContainer.querySelectorAll('.tag-pill').forEach(p => p.classList.remove('selected'));
        applyFilters();
    });

    langBtn.addEventListener('click', () => {
        currentLanguage = currentLanguage === 'en' ? 'it' : 'en';
        langBtn.textContent = currentLanguage === 'en' ? 'IT' : 'EN';
        searchInput.placeholder = currentLanguage === 'en' ? 'Search notes...' : 'Cerca una nota...';
        loadNotes();
    });

    loadNotes();
});
</script>
</body>
</html>
