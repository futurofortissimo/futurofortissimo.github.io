<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Futuro Fortissimo Michele Merelli</title>
    <meta name="description" content="Exploring the potential of technology and sustainability to build a greener future. Discover how innovative solutions in climate change can pave the way for new communities and even new nation states.">

    <!-- CSS Dependencies -->
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-pbM5zV8w5g1yh0Dz9GXwTXV5FZ5nlk1I0oXcHDEU5Yv2R6K9mxZcM+kBj3LJxJYkUlljb1QiUaZhy/XfHZOzNQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Tailwind CSS CDN for Styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Icons -->
    <link rel="icon" href="/index_files/ff.webp" type="image/webp">
    <link rel="apple-touch-icon" href="/index_files/ff.webp">

    <!-- Google Tag Manager -->
    <script>
    (function(w,d,s,l,i){
        w[l]=w[l]||[];
        w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'});
        var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),
            dl=l!='dataLayer'?'&l='+l:'';
        j.async=true;
        j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
        f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NFZJWGL2');
    </script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NQ7MQR0VL8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-NQ7MQR0VL8');
    </script>

    <!-- Custom Styles -->
    <style>
        body {
            margin: 0;
            font-family: 'Palladio', sans-serif;
            background-color: #f9f9f9;
        }
        header {
            @apply fixed top-0 w-full h-16 bg-white border-b border-black z-50 flex justify-between items-center px-4;
        }
        header .title {
            @apply text-2xl font-bold italic;
            font-family: 'ArgosBoldItalic', sans-serif;
            text-decoration: none;
            color: black;
        }
        header .language-switch {
            cursor: pointer;
            width: 30px;
            height: 20px;
        }
        .button-container {
            @apply text-center text-lg my-5;
        }
        .button-container a {
            @apply text-black no-underline font-bold mx-2 border-2 border-black px-4 py-2 rounded-full transition duration-300;
        }
        .button-container a:hover {
            @apply bg-black text-white;
        }
        .micmer-button {
            @apply bg-blue-500 text-white;
        }
        .micmer-button:hover {
            @apply bg-blue-700;
        }
        .support-share-container {
            @apply text-center text-lg my-5;
        }
        .support-share-container a {
            @apply text-black no-underline font-bold mx-2 border-2 border-black px-4 py-2 rounded-full transition duration-300;
        }
        .support-share-container a:hover {
            @apply bg-black text-white;
        }
        .swiper-container {
            width: 100%;
            padding: 100px 0 50px 0; /* Adjust padding to avoid overlapping with fixed header */
        }
        .swiper-slide {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .swiper-slide:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .swiper-slide img {
            width: 100%;
            height: auto;
            border-radius: 5px;
        }
        /* Responsive Adjustments */
        @media (max-width: 768px) {
            header .title {
                @apply text-xl;
            }
            .button-container, .support-share-container {
                @apply text-base;
            }
            .button-container a, .support-share-container a {
                @apply px-3 py-2 mx-1 text-sm;
            }
            .swiper-container {
                padding: 120px 0 50px 0;
            }
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NFZJWGL2"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <!-- Header -->
    <header>
        <a href="https://futurofortissimo.github.io/" class="title">futuro fortissimo</a>
        <img src="path-to-uk-flag-icon.png" alt="English" class="language-switch" title="Switch to English">
    </header>

    <!-- Main Content -->
    <main class="mt-16"> <!-- Add top margin to prevent content from being hidden behind the fixed header -->
        <!-- Primary Button Container -->
        <div class="button-container">
            <a href="https://futurofortissimo.github.io/strumenti.html">Strumenti üõ†Ô∏è</a>
            <a href="https://futurofortissimo.github.io/note.html">Note üéµ</a>
            <a href="https://www.notion.so/micmer/micmer-e6d52ba154814595b2eca4669c938d67" class="micmer-button">Micmer üìù</a>
        </div>

        <!-- Swiper Slider -->
        <div class="swiper-container">
            <div class="swiper-wrapper">
                <!-- Slides will be dynamically injected here -->
            </div>
            <!-- Add Pagination -->
            <div class="swiper-pagination"></div>
            <!-- Add Navigation -->
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
        </div>

        <!-- Additional Button Container -->
        <div class="support-share-container">
            <a href="https://www.paypal.com/paypalme/michelemerelli">Supporta üç©</a>
            <a href="https://api.whatsapp.com/send?text=https://futurofortissimo.github.io">Condividi üìß</a>
        </div>

        <!-- Content Area for CSV Data -->
        <div id="content-area" class="p-4"></div>
    </main>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Swiper.js -->
<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
<script>
$(document).ready(function() {
    // Accordion Functionality
    $(".accordion").click(function() {
        $(this).toggleClass("active");
        var panel = $(this).next();
        if (panel.css('display') === "none") {
            panel.slideDown(200);
        } else {
            panel.slideUp(200);
        }
    });

    // Adjust Image Box Width Based on Window Size
    function adjustImageBoxWidth() {
        const imageBox = $('.image-box');
        if ($(window).width() < 600) {
            imageBox.css('width', '90%');
        } else {
            imageBox.css('width', '80%');
        }
    }

    adjustImageBoxWidth(); // Initial adjustment
    $(window).resize(adjustImageBoxWidth); // Adjust on window resize

    // Update Page Content with Selected Entry
    function updatePage(entry) {
        $('.image-box').css('background-image', `linear-gradient(rgba(0, 0, 139, 0.62), rgba(0, 0, 139, 0.22) 30%, rgba(128, 0, 128, 0.22) 70%, rgba(128, 0, 128, 0.62)), url('${entry.img}')`);
        $('.post-title').html(`<div style="font-size: 24px; font-family: 'ArgosBoldItalic';">${entry.title}</div>`);
        $('.post-subtitle').html(entry.subtitle);

        $('#image-box-link').attr('href', entry.readMoreUrl);

        const linksHTML = entry.links.map(link => `<li class="post-subtitle"><a class="post-subtitle" href="${link.url}">${link.text}</a></li>`).join('');
        $('ul').html(linksHTML);
    }

    // Fetch Data from pubs.json and Initialize Page with a Random Entry
    fetch('index_files/pubs.json?' + new Date().getTime())
        .then(response => response.json())
        .then(data => {
            const randomEntryIndex = Math.floor(Math.random() * data.length);
            const randomEntry = data[randomEntryIndex];
            updatePage(randomEntry);
        })
        .catch(error => console.error('Error loading the JSON file:', error));

    // Handle Slider Button Clicks to Update Page Content
    fetch('pubs_en.json?' + new Date().getTime())
        .then(response => response.json())
        .then(data => {
            $('.slider-btn').on('click', function() {
                const key = $(this).data('key');
                const entry = data.find(item => item.title.includes(key));
                if (entry) {
                    updatePage(entry);
                } else {
                    console.error(`Entry not found for key: ${key}`);
                }
            });
        })
        .catch(error => console.error('Error loading the JSON file:', error));

    // Handle Scroll Opacity for Icons Container
    let timeout;
    const iconsContainer = $('.icons-container');

    $(window).on('scroll', function() {
        iconsContainer.css('opacity', '0');
        clearTimeout(timeout);
        timeout = setTimeout(() => {
            iconsContainer.css('opacity', '1');
        }, 3000); // 3 seconds
    });

    // Load and Display CSV Data
    let allData = [];
    const paroleEscluse = ['perch√®', 'perch√©', 'quando', 'e', 'ma', 'se', 'come', 'con', 'su', 'per', 'tra', 'fra', 'nel', 'nello', 'nella', 'nei', 'nelle', 'al', 'allo', 'alla', 'ai', 'agli', 'alle', 'dal', 'dallo', 'dalla', 'dai', 'dagli', 'dalle', 'del', 'dello', 'della', 'dei', 'degli', 'delle', 'sul', 'sullo', 'sulla', 'sui', 'sugli', 'sulle', 'un', 'uno', 'una', 'gli', 'le', 'di', 'da', 'in', 'a', 'da', 'che', 'chi', 'cosa', 'quale', 'quanto', 'quanta', 'quanti', 'quante', 'dove', 'come', 'quando', 'perch√©', 'anche', 'solo', 'qui', 'l√¨', 'l√†', 'dunque', 'quindi', 'perci√≤', 'anche', 'ancora', 'gi√†', 'mai', 'sempre', 'poi', 'prima', 'dopo', 'sopra', 'sotto', 'contro', 'molto', 'poco', 'troppo', 'pi√π', 'meno', 'bene', 'male', 'meglio', 'peggio', 'quasi', 'circa', 'appena', 'solo', 'tanto', 'cos√¨', 'pure', 'anche', 'neanche', 'nemmeno', 'quasi', 'sia', 'anche'];

    // Function to Update Content Area with CSV Data
    function updateContent(data) {
        const contentArea = $('#content-area');
        contentArea.empty(); // Clear existing content

        // Shuffle data and limit to available entries
        let displayData = data.sort(() => 0.5 - Math.random());

        displayData.forEach((row, index) => {
            if (row.length < 3) return; // Ensure row has enough columns

            const contentDiv = $('<div>').addClass('highlight-on-hover').css({
                'border-radius': '10px',
                'padding': '10px',
                'margin-bottom': '20px',
                'box-shadow': '0 2px 4px rgba(0,0,0,0.1)',
                'background-color': '#f9f9f9',
                'position': 'relative'
            });

            const textDiv = $('<div>').text(row[1]).css({
                'margin-bottom': '10px',
                'cursor': 'pointer'
            }).on('click', function() {
                window.open(row[2], '_blank'); // Open link in new tab
            });

            const topicsDiv = $('<div>').text(row[0]).css('text-align', 'left');

            const url = new URL(row[2]);
            const domainNoteContainer = $('<div>').css({
                'display': 'flex',
                'align-items': 'center'
            });

            const domainText = $('<span>').text(url.hostname);
            const noteNumber = row[row.length - 1].replace('#', '');
            const noteSpan = $('<span>').text(` üéµ ${noteNumber}`).css('margin-left', '5px');

            domainNoteContainer.append(domainText, noteSpan);

            const domainDiv = $('<div>').css({
                'position': 'absolute',
                'bottom': '5px',
                'right': '10px',
                'font-size': '12px',
                'color': '#777'
            }).append(domainNoteContainer);

            // Assemble the content
            contentDiv.append(textDiv, topicsDiv, domainDiv);
            contentArea.append(contentDiv);
        });
    }

    // Fetch CSV Data and Initialize Content Area
    fetch('/index_files/notes_ff_michele_merelli_2024_futuro_fortissimo.csv')
        .then(response => response.text())
        .then(csvText => {
            allData = csvText.trim().split('\n').map(row => row.split(','));
            updateContent(allData); // Display all data initially
        })
        .catch(error => console.error('Error loading the CSV file:', error));

    // Search and Filter Functionality
    function performSearch() {
        let filteredData = allData.slice(); // Clone allData
        const searchText = $('#csv-search-input').val().toLowerCase().split(' ').filter(parola => !paroleEscluse.includes(parola) && parola.trim() !== '');
        const categories = {
            'csv-checkbox-libri': 'üìö',
            'csv-checkbox-tecnologia': 'üíª',
            'csv-checkbox-uomo': '‚ù§Ô∏è',
            'csv-checkbox-salute': 'üíä',
            'csv-checkbox-intelligenza': 'üß†',
            'csv-checkbox-wellbeing': 'üíÜ',
            'csv-checkbox-clima': 'üçÉ',
            'csv-checkbox-futuro': 'üéº',
            'csv-checkbox-criptovalute': 'üí∏',
            'csv-checkbox-sport': '‚öΩ',
            'csv-checkbox-alimentazione': 'üçΩÔ∏è',
            'csv-checkbox-podcast': 'üéôÔ∏è',
            'csv-checkbox-art': 'üé®',
            'csv-checkbox-metaverse': 'ü•Ω',
            'csv-checkbox-mobility': 'üöï',
            'csv-checkbox-society': 'üë•'
        };

        // Filter based on search text
        if (searchText.length > 0) {
            filteredData = filteredData.filter(row =>
                searchText.some(parola =>
                    row.some(cell => cell.toLowerCase().includes(parola))
                )
            );
        }

        // Filter based on checked categories
        $.each(categories, function(checkboxId, emoji) {
            if ($('#' + checkboxId).is(':checked')) {
                filteredData = filteredData.filter(row => row.some(cell => cell.includes(emoji)));
            }
        });

        updateContent(filteredData);
    }

    // Event Listeners for Search and Filters
    $('#csv-search-button, #div_search, #div_search_2, #div_search_4, #div_search_5').on('click', performSearch);
    $('input[type="checkbox"]').on('change', performSearch);
    $(document).on('keypress', function(e) {
        if (e.key === 'Enter') performSearch();
    });

    // Reset Checkboxes and Refresh Content
    $('#refreshButton').on('click', function() {
        $('input[type="checkbox"]').prop('checked', false);
        $('#csv-search-input').val('');
        updateContent(allData); // Reset to show all data
    });

    // Initialize Swiper.js Carousel with 5 Previews
    var swiper = new Swiper('.swiper-container', {
        slidesPerView: 5,
        spaceBetween: 30,
        loop: true,
        pagination: {
            el: '.swiper-pagination',
            clickable: true,
        },
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
        },
        breakpoints: {
            320: {
                slidesPerView: 1,
                spaceBetween: 10,
            },
            640: {
                slidesPerView: 2,
                spaceBetween: 20,
            },
            768: {
                slidesPerView: 3,
                spaceBetween: 30,
            },
            1024: {
                slidesPerView: 5,
                spaceBetween: 30,
            },
        },
    });

    // Optional: Initialize a Second Swiper Instance if Needed
    /*
    var mySwiper = new Swiper('.mySwiper', {
        slidesPerView: 7,
        spaceBetween: 1,
        freeMode: true,
        pagination: {
            el: '.swiper-pagination',
            clickable: true,
        },
        mousewheel: {
            invert: false,
        },
        zoom: {
            maxRatio: 1.1,
        },
        on: {
            init: function() {
                const swiperInstance = this;
                swiperInstance.slides.each((index, slide) => {
                    $(slide).on('mouseenter', () => swiperInstance.zoom.in());
                    $(slide).on('mouseleave', () => swiperInstance.zoom.out());
                });
            },
        },
    });
    */

    // Language Switcher Placeholder (UK Flag Click Event)
    $('.language-switch').on('click', function() {
        // Placeholder for language switching functionality
        // You can implement language toggling here
        alert('Language switch to English triggered!');
    });
});
</script>
</body>
</html>
