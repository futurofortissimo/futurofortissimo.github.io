<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Futuro Fortissimo</title>
    <!-- Google Fonts for Modern Typography -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <!-- Swiper CSS for Sliders -->
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <!-- Custom CSS -->
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8f8f2; /* Off-white background */
            color: #333;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        /* Header Styles */
        header {
            position: fixed;
            top: 0;
            width: 100%;
            height: 70px;
            background-color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        header a {
            font-size: 24px;
            font-family: 'Playfair Display', serif;
            color: #333;
        }

        /* Main Container */
        .container {
            padding-top: 80px; /* Space for fixed header */
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Theme Slider */
        .theme-slider {
            margin-bottom: 20px;
        }

        .theme-slider .swiper-slide {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #ffffff;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .theme-slider .swiper-slide button {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #333;
            font-family: 'Roboto', sans-serif;
        }

        .theme-slider .swiper-slide button.active {
            color: #007BFF; /* Highlight active theme */
        }

        /* Sub-Themes Slider */
        .subtheme-slider {
            margin-bottom: 20px;
        }

        .subtheme-slider .swiper-slide {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #ffffff;
            border-radius: 20px;
            padding: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .subtheme-slider .swiper-slide button {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #333;
            font-family: 'Roboto', sans-serif;
        }

        .subtheme-slider .swiper-slide button.active {
            color: #007BFF;
        }

        /* Search Section */
        .search-section {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            gap: 10px;
        }

        .search-section input[type="text"] {
            width: 100%;
            max-width: 500px;
            padding: 10px 15px;
            border: 2px solid #ccc;
            border-radius: 42px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .search-section input[type="text"]:focus {
            border-color: #007BFF;
            outline: none;
        }

        .search-section button {
            padding: 10px 15px;
            border: none;
            background-color: #007BFF;
            color: #fff;
            border-radius: 42px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .search-section button:hover {
            background-color: #0056b3;
        }

        /* Content Area */
        #content-area {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 60px;
        }

        .note-card {
            background-color: #ffffff;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            cursor: pointer;
            position: relative;
        }

        .note-card:hover {
            transform: translateY(-5px);
        }

        .note-card .topic {
            font-weight: bold;
            margin-bottom: 10px;
            font-family: 'Playfair Display', serif;
        }

        .note-card .content {
            margin-bottom: 10px;
        }

        .note-card .domain-note {
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-size: 12px;
            color: #777;
            display: flex;
            align-items: center;
        }

        .note-card .domain-note span {
            margin-left: 5px;
        }

        /* Swiper Pagination */
        .swiper-pagination-bullet-active {
            background-color: #007BFF;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .theme-slider .swiper-slide button {
                font-size: 20px;
            }

            .subtheme-slider .swiper-slide button {
                font-size: 16px;
            }

            .search-section input[type="text"] {
                max-width: 100%;
            }
        }
    </style>
    <!-- Swiper JS -->
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <!-- jQuery (Optional if needed) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

    <header>
        <a href="https://futurofortissimo.github.io/">futuro fortissimo</a>
    </header>

    <div class="container">
        <!-- Main Themes Slider -->
        <div class="theme-slider">
            <div class="swiper mySwiperTheme">
                <div class="swiper-wrapper">
                    <div class="swiper-slide">
                        <button class="theme-btn active" data-theme="Natura">üåø<span>Natura</span></button>
                    </div>
                    <div class="swiper-slide">
                        <button class="theme-btn" data-theme="Tecnologia">üíª<span>Tecnologia</span></button>
                    </div>
                    <div class="swiper-slide">
                        <button class="theme-btn" data-theme="Societ√†">üë•<span>Societ√†</span></button>
                    </div>
                </div>
                <div class="swiper-pagination"></div>
            </div>
        </div>

        <!-- Sub-Themes Slider -->
        <div class="subtheme-slider">
            <div class="swiper mySwiperSubTheme">
                <div class="swiper-wrapper" id="subtheme-container">
                    <!-- Dynamically populated based on selected main theme -->
                </div>
                <div class="swiper-pagination"></div>
            </div>
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <input type="text" id="csv-search-input" placeholder="Cerca una Nota üéµ">
            <button id="csv-search-button">üîç</button>
            <button id="refreshButton">üîÑ</button>
        </div>

        <!-- Content Area -->
        <div id="content-area">
            <!-- Notes will be dynamically inserted here -->
        </div>
    </div>

    <!-- Custom JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Theme Swiper
            var themeSwiper = new Swiper('.mySwiperTheme', {
                slidesPerView: 3,
                spaceBetween: 10,
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
            });

            // Initialize SubTheme Swiper
            var subThemeSwiper = new Swiper('.mySwiperSubTheme', {
                slidesPerView: 'auto',
                spaceBetween: 10,
                freeMode: true,
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
            });

            const mainThemes = {
                'Natura': ['Ambiente', 'Clima', 'Biodiversit√†'],
                'Tecnologia': ['AI', 'Robotica', 'Blockchain'],
                'Societ√†': ['Educazione', 'Salute', 'Economia']
            };

            const subthemeContainer = document.getElementById('subtheme-container');

            // Function to populate sub-themes based on selected main theme
            function populateSubThemes(theme) {
                subthemeContainer.innerHTML = '';
                mainThemes[theme].forEach(sub => {
                    const slide = document.createElement('div');
                    slide.classList.add('swiper-slide');
                    const button = document.createElement('button');
                    button.classList.add('subtheme-btn');
                    button.textContent = sub;
                    button.dataset.subtheme = sub;
                    slide.appendChild(button);
                    subthemeContainer.appendChild(slide);
                });
                subThemeSwiper.update(); // Update swiper after adding slides
            }

            // Initial population of sub-themes for the first theme
            populateSubThemes('Natura');

            // Handle main theme button clicks
            document.querySelectorAll('.theme-btn').forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all theme buttons
                    document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
                    // Add active class to the clicked button
                    this.classList.add('active');
                    // Populate sub-themes based on selected theme
                    const selectedTheme = this.dataset.theme;
                    populateSubThemes(selectedTheme);
                    // Perform search/filter based on theme
                    performSearch();
                });
            });

            // Fetch CSV Data
            let allData = [];
            fetch('/index_files/notes_ff_michele_merelli_2024_futuro_fortissimo.csv')
                .then(response => response.text())
                .then(csvText => {
                    allData = parseCSV(csvText);
                    updateContent(allData.slice(0, 10)); // Display first 10 notes initially
                })
                .catch(error => console.error('Error loading the CSV file:', error));

            // Parse CSV into array of objects
            function parseCSV(csvText) {
              const lines = csvText.trim().split('\n');
              const headers = lines[0].split(',,');

              // Check if headers exist and have valid length
              if (headers.length === 0) {
                  console.error("Error: CSV file is missing headers.");
                  return [];
              }

              return lines.slice(1).map((line, index) => {
                  const values = line.split(',,');

                  // Ensure the row has the same number of values as there are headers
                  if (values.length !== headers.length) {
                      console.warn(`Warning: Skipping row ${index + 2} due to column mismatch.`);
                      return null; // Skip this row
                  }

                  let obj = {};
                  headers.forEach((header, idx) => {
                      const value = values[idx] ? values[idx].trim() : ''; // Handle undefined or missing values
                      obj[header.trim()] = value;
                  });
                  return obj;
              }).filter(row => row !== null); // Filter out any null rows
          }

            // Update Content Area with Notes
            function updateContent(data) {
                const contentArea = document.getElementById('content-area');
                contentArea.innerHTML = ''; // Clear existing content

                data.forEach(row => {
                    const noteCard = document.createElement('div');
                    noteCard.classList.add('note-card');

                    // Topic
                    const topicDiv = document.createElement('div');
                    topicDiv.classList.add('topic');
                    topicDiv.textContent = row['Topic']; // Assuming 'Topic' column exists
                    noteCard.appendChild(topicDiv);

                    // Content
                    const contentDiv = document.createElement('div');
                    contentDiv.classList.add('content');
                    contentDiv.textContent = row['Content']; // Assuming 'Content' column exists
                    noteCard.appendChild(contentDiv);

                    // Domain and Note
                    const domainNoteDiv = document.createElement('div');
                    domainNoteDiv.classList.add('domain-note');

                    const url = new URL(row['URL']); // Assuming 'URL' column exists
                    const domainSpan = document.createElement('span');
                    domainSpan.textContent = url.hostname;
                    domainNoteDiv.appendChild(domainSpan);

                    const noteSpan = document.createElement('span');
                    noteSpan.textContent = `üéµ ${row['Note']}`; // Assuming 'Note' column exists
                    domainNoteDiv.appendChild(noteSpan);

                    noteCard.appendChild(domainNoteDiv);

                    // Click to open URL
                    noteCard.addEventListener('click', () => {
                        window.open(row['URL'], '_blank');
                    });

                    contentArea.appendChild(noteCard);
                });
            }

            // Search Logic
            const searchInput = document.getElementById('csv-search-input');
            const searchButton = document.getElementById('csv-search-button');
            const refreshButton = document.getElementById('refreshButton');

            // List of excluded words
            const paroleEscluse = ['perch√®', 'perch√©', 'quando', 'e', 'ma', 'se', 'come', 'con', 'su', 'per', 'tra', 'fra', 'nel', 'nello', 'nella', 'nei', 'nelle', 'al', 'allo', 'alla', 'ai', 'agli', 'alle', 'dal', 'dallo', 'dalla', 'dai', 'dagli', 'dalle', 'del', 'dello', 'della', 'dei', 'degli', 'delle', 'sul', 'sullo', 'sulla', 'sui', 'sugli', 'sulle', 'un', 'uno', 'una', 'gli', 'le', 'di', 'da', 'in', 'a', 'da', 'che', 'chi', 'cosa', 'quale', 'quanto', 'quanta', 'quanti', 'quante', 'dove', 'come', 'quando', 'perch√©', 'anche', 'solo', 'qui', 'l√¨', 'l√†', 'dunque', 'quindi', 'perci√≤', 'anche', 'ancora', 'gi√†', 'mai', 'sempre', 'poi', 'prima', 'dopo', 'sopra', 'sotto', 'contro', 'molto', 'poco', 'troppo', 'pi√π', 'meno', 'bene', 'male', 'meglio', 'peggio', 'quasi', 'circa', 'appena', 'solo', 'tanto', 'cos√¨', 'pure', 'anche', 'neanche', 'nemmeno', 'quasi', 'sia', 'anche'];

            function performSearch() {
                let filteredData = allData; // Start with all data
                const searchText = searchInput.value.toLowerCase().split(' ').filter(parola => !paroleEscluse.includes(parola) && parola.trim() !== '');

                // Get selected main theme
                const selectedTheme = document.querySelector('.theme-btn.active').dataset.theme;

                // Get selected sub-themes
                const selectedSubThemes = Array.from(document.querySelectorAll('.subtheme-btn.active')).map(btn => btn.dataset.subtheme);

                // Filter based on search text
                if (searchText.length > 0) {
                    filteredData = filteredData.filter(row =>
                        searchText.some(parola =>
                            row['Content'].toLowerCase().includes(parola)
                        )
                    );
                }

                // Filter based on main theme
                if (selectedTheme) {
                    filteredData = filteredData.filter(row => row['Topic'] === selectedTheme);
                }

                // Filter based on sub-themes
                if (selectedSubThemes.length > 0) {
                    filteredData = filteredData.filter(row => selectedSubThemes.includes(row['SubTheme']));
                }

                // Limit to 10 notes
                filteredData = filteredData.slice(0, 10);

                updateContent(filteredData);
            }

            // Event Listeners for Search and Refresh
            searchButton.addEventListener('click', performSearch);
            refreshButton.addEventListener('click', function() {
                resetFilters();
                updateContent(allData.slice(0, 10));
            });

            // Handle Enter key for search
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') performSearch();
            });

            // Function to reset all filters
            function resetFilters() {
                searchInput.value = '';
                document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector('.theme-btn').classList.add('active'); // Activate first theme
                populateSubThemes('Natura');
                document.querySelectorAll('.subtheme-btn').forEach(btn => btn.classList.remove('active'));
            }

            // Handle SubTheme button clicks
            document.addEventListener('click', function(e) {
                if (e.target && e.target.matches('.subtheme-btn')) {
                    e.target.classList.toggle('active');
                    performSearch();
                }
            });

            // Handle Theme button clicks
            document.addEventListener('click', function(e) {
                if (e.target && e.target.matches('.theme-btn')) {
                    document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    const selectedTheme = e.target.dataset.theme;
                    populateSubThemes(selectedTheme);
                    performSearch();
                }
            });
        });
    </script>

</body>
</html>
